function _createForOfIteratorHelper(t,a){var e;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=_unsupportedIterableToArray(t))||a&&t&&"number"==typeof t.length){e&&(t=e);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,i=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return o=t.done,t},e:function(t){i=!0,n=t},f:function(){try{o||null==e.return||e.return()}finally{if(i)throw n}}}}function _unsupportedIterableToArray(t,a){if(t){if("string"==typeof t)return _arrayLikeToArray(t,a);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,a):void 0}}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,s=new Array(a);e<a;e++)s[e]=t[e];return s}function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}!function(t){var a={};function e(s){if(a[s])return a[s].exports;var r=a[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=a,e.d=function(t,a,s){e.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,a){if(1&a&&(t=e(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var r in t)e.d(s,r,(function(a){return t[a]}).bind(null,r));return s},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},e.p="",e(e.s="fmah")}({fmah:function(t,a,e){"use strict";e.r(a);var s=function t(a){_classCallCheck(this,t),this.shipData=a,this.accumulatedThreat=0,this.armour=a.totalArmour,this.shield=a.totalShield,this.threat=a.threat},r=function t(){_classCallCheck(this,t),this.threatMulti=1},n=function t(){_classCallCheck(this,t),this.quantity=0,this.quantityEnd=0,this.lost=0,this.exploded=0,this.kills=0,this.oneShotted=0,this.oneShotDone=0,this.damageDone=0,this.armourDamageDone=0,this.shieldDamageDone=0,this.damageTaken=0,this.armourDamageTaken=0,this.shieldDamageTaken=0,this.deathTargets=0,this.aliveTargets=0,this.aliveTargetsShield=0,this.aliveTargetsNoShield=0,this.explosionTriggered=0,this.shotTaken=0,this.shotTakenDeath=0,this.shieldRegenerationReceived=0,this.threatAvg=0,this.threatQta=0,this.shipHit=0,this.defenceHit=0},o=function t(){_classCallCheck(this,t),this.name=""},i=function t(){_classCallCheck(this,t),this.won=!1};function l(t,a){for(var e=0,s=a.shieldPercent*a.adaptivePrecision,r=a.armourPercent*a.adaptivePrecision,n=(a.defencePercent-1)*a.adaptivePrecision,o=0,i=t.length;o<i;o++)e+=t[o].totalThreat,e+=t[o].alive.length*a.precision,e+=s*t[o].withShield,e+=r*t[o].withArmour,t[o].isDefence&&(e+=n*t[o].alive.length);for(var l,h=Math.random()*e,d=0,u=0,p=t.length;u<p;u++)for(var f=0,c=t[u].ships.length;f<c;f++)if(d+=(l=t[u].ships[f]).threat,t[u].isDefence&&(d+=n),l.shield>0&&(d+=s),l.armour>0&&(d+=r,d+=a.precision),d>=h)return l}function h(t,a,e,s){var r=0,n=t.damage;a.shipData.isDefence&&(n*=t.defencePercent);var o=a.armour>=a.shipData.totalArmour&&a.shield>=a.shipData.totalShield;if(a.shield>0){var i=0;if(n*=t.shieldPercent,(n-=a.shipData.shieldReduction)>0){var l=a.shield;a.shield-=n,a.shield>0?(i=n,n=0):(n=-1*a.shield/t.shieldPercent,i=l,a.shipData.withShield--,a.shipData.withArmour++),a.shipData.stats.rounds[s].damageTaken+=i,a.shipData.stats.rounds[s].shieldDamageTaken+=i,e.shipData.stats.rounds[s].damageDone+=i,e.shipData.stats.rounds[s].shieldDamageDone+=i,e.shipData.stats.rounds[s].aliveTargetsShield++,r+=i}}else e.shipData.stats.rounds[s].aliveTargetsNoShield++;if(n>0&&(n*=t.armourPercent,(n-=a.shipData.armourReduction)>0)){var d=a.armour;a.armour-=n;var u=Math.max(d-a.armour,0);a.shipData.stats.rounds[s].damageTaken+=u,a.shipData.stats.rounds[s].armourDamageTaken+=u,e.shipData.stats.rounds[s].damageDone+=u,e.shipData.stats.rounds[s].armourDamageDone+=u,r+=u}if(r>0&&(e.accumulatedThreat+=r*t.threatMulti),a.shield<=.001&&a.armour>0&&a.armour<a.shipData.explosionThreshold){var p=1-a.armour/a.shipData.explosionThreshold;Math.random()<p&&(a.armour=0,a.shipData.stats.rounds[s].exploded++,e.shipData.stats.rounds[s].explosionTriggered++,a.shipData.explosionDamage>0&&e.armour>0&&h(a.shipData.explosionWeapon,e,a,s))}if(a.armour<=0){var f=a.shipData.alive.indexOf(a);f>=0&&a.shipData.alive.splice(f,1),a.shipData.withArmour--,a.shipData.stats.rounds[s].lost++,e.shipData.stats.rounds[s].kills++,o&&(a.shipData.stats.rounds[s].oneShotted++,e.shipData.stats.rounds[s].oneShotDone++)}}addEventListener("message",(function(t){var a=t.data,e=function(t){for(var a=new i,e=[t.enemyFleet,t.playerFleet],d=function(t,a){e[t].forEach((function(a){a.ships=[],a.alive=[],a.targets=0===t?e[1]:e[0],a.explosionDamage>0&&(a.explosionWeapon=new r,a.explosionWeapon.shieldPercent=1,a.explosionWeapon.armourPercent=1,a.explosionWeapon.damage=a.explosionDamage),a.totalThreat=a.threat*a.quantity,a.stats=new o,a.stats.name=a.name,a.stats.designId=a.designId,a.stats.player=1===t,a.stats.total=new n,a.stats.total.quantity=a.quantity,a.stats.rounds=new Array(5);for(var i=0,l=a.weapons.length;i<l;i++)a.weapons[i].armourPercent/=100,a.weapons[i].shieldPercent/=100,a.weapons[i].defencePercent/=100;for(var h=0;h<5;h++)a.stats.rounds[h]=new n;for(var d=0;d<a.quantity;d++){var u=new s(a);a.ships.push(u),a.alive.push(u)}a.totalShield>0?(a.withArmour=0,a.withShield=a.quantity):(a.withArmour=a.quantity,a.withShield=0)}))},u=0,p=e.length;u<p;u++)d(u);for(var f=0;f<5;f++){for(var c=0;c<2;c++)for(var g=e[c],v=0,m=g.length;v<m;v++){var D=g[v];D.stats.rounds[f].quantity=D.ships.length;for(var y=0,T=D.ships.length;y<T;y++)for(var S=D.ships[y],k=0,w=D.weapons.length;k<w;k++){var x=l(S.shipData.targets,D.weapons[k]);x&&(x.shipData.stats.rounds[f].shotTaken++,x.shipData.isDefence?S.shipData.stats.rounds[f].defenceHit++:S.shipData.stats.rounds[f].shipHit++,x.armour>0?(S.shipData.stats.rounds[f].aliveTargets++,h(D.weapons[k],x,S,f)):(S.shipData.stats.rounds[f].deathTargets++,x.shipData.stats.rounds[f].shotTakenDeath++))}}for(var b=0;b<2;b++)for(var A=e[b],P=0,_=A.length;P<_;P++){for(var I=0,C=A[P].ships.length;I<C;I++){var q=A[P].ships[I].threat;A[P].stats.rounds[f].threatAvg+=q,A[P].stats.total.threatAvg+=q}A[P].ships.length>0?A[P].stats.rounds[f].threatAvg/=A[P].ships.length:A[P].stats.rounds[f].threatAvg=0,A[P].stats.total.threatQta+=A[P].ships.length}for(var O=0;O<2;O++)for(var M=e[O],R=0,H=M.length;R<H;R++){var j=M[R];if(j.ships=j.alive.slice(),j.stats.rounds[f].quantityEnd=j.alive.length,f<4){j.totalThreat=0;for(var F=0,E=j.alive.length;F<E;F++)j.alive[F].threat+=j.alive[F].accumulatedThreat+j.thereatPerRound,j.alive[F].accumulatedThreat=0,j.totalThreat+=j.alive[F].threat}}for(var L=0;L<2;L++){for(var W=e[L],N=0,Q=new Array,U=0,$=W.length;U<$;U++){var z=W[U];N+=z.shieldRecharge*z.alive.length;for(var B=0,G=z.alive.length;B<G;B++)z.alive[B].shield>0&&z.alive[B].shield<z.alive[B].shipData.totalShield&&Q.push(z.alive[B])}if(N>0&&Q.length>0)for(var J=0,K=(Q=Q.sort((function(t,a){return(t.shipData.totalShield-t.shield)/t.shipData.totalShield-(a.shipData.totalShield-a.shield)/a.shipData.totalShield}))).length;J<K;J++)if(N>0){var V=Q[J].shield;Q[J].shield=Math.min(Q[J].shield+N,Q[J].shipData.totalShield);var X=Q[J].shield-V;N-=X,Q[J].shipData.stats.rounds[f].shieldRegenerationReceived+=X}}if(t.enemyFleet.findIndex((function(t){return t.ships.length>0}))<0||t.playerFleet.findIndex((function(t){return t.ships.length>0}))<0)break}a.gameId=t.gameId,a.playerLost=[];var Y,Z=_createForOfIteratorHelper(t.playerFleet);try{for(Z.s();!(Y=Z.n()).done;){var tt=Y.value,at=tt.quantity-tt.ships.length;at>0&&a.playerLost.push({id:tt.designId,lost:at})}}catch(lt){Z.e(lt)}finally{Z.f()}a.enemyLost=[];var et,st=_createForOfIteratorHelper(t.enemyFleet);try{for(st.s();!(et=st.n()).done;){var rt=et.value,nt=rt.quantity-rt.ships.length;nt>0&&a.enemyLost.push({id:rt.designId,lost:nt})}}catch(lt){st.e(lt)}finally{st.f()}a.stats=[];for(var ot=0,it=e.length;ot<it;ot++)e[ot].forEach((function(t){for(var e=0;e<5;e++)t.stats.total.exploded+=t.stats.rounds[e].exploded,t.stats.total.kills+=t.stats.rounds[e].kills,t.stats.total.lost+=t.stats.rounds[e].lost,t.stats.total.quantityEnd=t.alive.length,t.stats.total.oneShotted+=t.stats.rounds[e].oneShotted,t.stats.total.shotTaken+=t.stats.rounds[e].shotTaken,t.stats.total.shotTakenDeath+=t.stats.rounds[e].shotTakenDeath,t.stats.total.aliveTargetsShield+=t.stats.rounds[e].aliveTargetsShield,t.stats.total.aliveTargetsNoShield+=t.stats.rounds[e].aliveTargetsNoShield,t.stats.total.explosionTriggered+=t.stats.rounds[e].explosionTriggered,t.stats.total.oneShotDone+=t.stats.rounds[e].oneShotDone,t.stats.total.deathTargets+=t.stats.rounds[e].deathTargets,t.stats.total.aliveTargets+=t.stats.rounds[e].aliveTargets,t.stats.total.damageDone+=t.stats.rounds[e].damageDone,t.stats.total.armourDamageDone+=t.stats.rounds[e].armourDamageDone,t.stats.total.shieldDamageDone+=t.stats.rounds[e].shieldDamageDone,t.stats.total.damageTaken+=t.stats.rounds[e].damageTaken,t.stats.total.armourDamageTaken+=t.stats.rounds[e].armourDamageTaken,t.stats.total.shieldDamageTaken+=t.stats.rounds[e].shieldDamageTaken,t.stats.total.shieldRegenerationReceived+=t.stats.rounds[e].shieldRegenerationReceived,t.stats.total.shipHit+=t.stats.rounds[e].shipHit,t.stats.total.defenceHit+=t.stats.rounds[e].defenceHit;t.stats.total.threatAvg=t.stats.total.threatQta>0?t.stats.total.threatAvg/t.stats.total.threatQta:0,a.stats.push(t.stats)}));return a.endTime=t.endTime,a}(a);postMessage(e),e=null,a=null}))}});